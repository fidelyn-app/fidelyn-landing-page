<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Changelog — Fidelyn</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="16x16"  href="../assets/favicons/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">
  <style>
    :root{
      --pink:#F22E52;
      --pink-2:#F22E52;
      --dark:#2b2b35;
      --muted:#6b6b75;
      --card-bg:#ffffff;
      --shadow: 0 10px 40px rgba(18,18,20,0.06);
      --accent: #0b84ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial; margin:0;color:var(--dark);background:#fff}
    a{color:inherit;text-decoration:none}

    /* Topbar / Header */
    .topbar{
      background:var(--pink);
      color:#fff;
      padding:18px 6vw;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .container{max-width:1100px;margin:0 auto;width:100%}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:44px;height:44px;border-radius:0px;padding:0px;background:linear-gradient(135deg,#fff 0%, rgba(255,255,255,0.6) 100%)}
    .brand h1{margin:0;font-size:18px;color:#fff;font-weight:600}
    .nav-links{display:flex;gap:24px;align-items:center}
    .nav-links a{color:rgba(255,255,255,0.95);font-weight:500;font-size:15px;padding:6px;border-radius:6px}
    .nav-links a:hover{background: rgba(255,255,255,0.06); transform:translateY(-2px)}

    /* HERO */
    .hero{
      background:linear-gradient(180deg,var(--pink),var(--pink-2));
      color:white;
      padding:56px 6vw;
      text-align:left;
    }
    .hero .container{display:flex;align-items:center;gap:40px}
    .hero-left{flex:1}
    .hero h2{font-size:40px;line-height:1.02;margin:6px 0 12px}
    .hero p.lead{max-width:640px;color:rgba(255,255,255,0.95); margin:0}

    /* MAIN */
    main{padding:40px 6vw 80px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:28px;max-width:1100px;margin:0 auto}
    .card{
      background:var(--card-bg);
      border-radius:12px;
      padding:22px;
      box-shadow:var(--shadow);
      border:1px solid rgba(18,18,20,0.03);
      color:var(--pink);
    }

    /* changelog list */
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:18px}
    .search{flex:1;min-width:160px}
    .search input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(18,18,20,0.06);font-size:14px}
    .filters{display:flex;gap:8px}
    .chip{padding:8px 12px;border-radius:999px;border:1px solid rgba(18,18,20,0.06);background:#fff;font-weight:600;cursor:pointer}
    .chip.active{background:linear-gradient(90deg,var(--pink),var(--pink-2));color:#fff;border:0;box-shadow:0 8px 30px rgba(242,46,82,0.12)}

    .timeline{display:flex;flex-direction:column;gap:16px}
    .release{display:flex;gap:16px;align-items:flex-start}
    .release .dot{width:12px;height:12px;border-radius:50%;background:var(--pink);margin-top:8px;flex:0 0 12px;box-shadow:0 4px 12px rgba(242,46,82,0.12)}
    .release .body{flex:1}
    .release h3{margin:0;font-size:16px}
    .meta{font-size:13px;color:var(--muted);margin-top:6px}
    .tags{display:flex;gap:8px;margin-top:12px}
    .tag{font-size:13px;padding:6px 8px;border-radius:8px;border:1px solid rgba(18,18,20,0.06);background:#fafafa}
    .tag.added{color:#04613a;background:#e6ffef;border-color:rgba(4,97,58,0.06)}
    .tag.changed{color:#6b46c1;background:#f5f3ff;border-color:rgba(107,70,193,0.06)}
    .tag.fixed{color:#b45309;background:#fff7ed;border-color:rgba(180,83,9,0.06)}

    .release ul{margin:10px 0 0 18px;padding:0}
    .release li{margin-bottom:8px}

    /* sidebar */
    .info h4{margin:0 0 6px}
    .version-quick{display:flex;flex-direction:column;gap:8px}
    .version-quick .v{padding:12px;border-radius:10px;border:1px solid rgba(18,18,20,0.03);background:#fff;cursor:pointer}
    .version-quick .v strong{display:block}

    .small{font-size:13px;color:var(--muted)}
    .controls-right{display:flex;gap:8px;align-items:center}

    footer{padding:28px 6vw;background:#fafafa;color:var(--muted);text-align:center;margin-top:36px}

    /* Responsive */
    @media (max-width:1024px){
      .grid{grid-template-columns:1fr 320px}
    }
    @media (max-width:820px){
      .hero .container{flex-direction:column}
      .grid{grid-template-columns:1fr;gap:18px}
      .nav-links{display:none}
      .hero h2{font-size:32px}
    }
  </style>
</head>
<body>
  <!-- TOPBAR -->
  <header class="topbar">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;">
      <div style="display:flex;align-items:center;gap:12px;">
        <div class="brand">
          <img src="./assets/logo.png" alt="logo">
          <h1>Fidelyn</h1>
        </div>
      </div>

      <nav class="nav-links" aria-label="Menu principal">
        <a href="index.html">Home</a>
        <a href="changelog.html">Changelog</a>
        <a href="contacts.html">Contato</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <div class="hero-left">
        <h2>Changelog</h2>
        <p class="lead">Registre as alterações, correções e novidades do produto. Filtre por tipo, busque por texto e importe de um arquivo JSON ou URL.</p>
      </div>
      <div style="flex:0 0 220px; text-align:right">
        <div class="card" style="display:inline-block; text-align:left">
          <strong>Estado atual</strong>
          <div style="margin-top:6px;color:var(--pink);; display:inline-block; background:rgba(255,255,255,0.06); padding:6px 10px; border-radius:8px" id="currentVersion">v1.4.0</div>
          <div style="font-size:13px;color:var(--pink);; margin-top:8px" id="currentDate">Última atualização: 2025-09-10</div>
        </div>
      </div>
    </div>
  </section>

  <main>
    <div class="grid">
      <section>
        <div class="card">
          <div class="controls">
            <div class="search"><input id="search" placeholder="Buscar no changelog (ex: correção, pagamento)..." /></div>

            <div class="controls-right">
              <div class="filters" role="tablist" aria-label="Filtros por tipo">
                <button class="chip active" data-filter="all">Todos</button>
                <button class="chip" data-filter="added">Adicionados</button>
                <button class="chip" data-filter="changed">Alterados</button>
                <button class="chip" data-filter="fixed">Corrigidos</button>
              </div>

              <div style="display:flex;gap:8px;align-items:center;margin-left:8px">
                <label class="chip" for="fileInput" style="cursor:pointer">Carregar JSON</label>
                <input id="fileInput" type="file" accept="application/json" style="display:none" />
                <button id="loadUrl" class="chip">Carregar por URL</button>
              </div>
            </div>
          </div>

          <div class="timeline" id="timeline">
            <!-- Releases serão inseridos aqui via JS -->
          </div>

        </div>

      </section>

      <aside class="info">
        <div class="card">
          <h4>Versões recentes</h4>
          <div class="version-quick" id="versionQuick">
            <!-- botões gerados dinamicamente -->
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h4>Exportar</h4>
          <p class="note">Exporte o changelog em JSON ou copie a entrada rapidamente.</p>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="exportJson" class="chip">Exportar JSON</button>
            <button id="copyAll" class="chip">Copiar tudo</button>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h4>Formato esperado</h4>
          <p class="small">O JSON deve ser um array de objetos com as chaves: <code>title</code>, <code>date</code>, <code>tags</code> (array) e <code>body</code> (array de strings).</p>
          <details style="margin-top:8px"><summary class="small">Exemplo</summary>
            <pre class="small" style="white-space:pre-wrap">[
  {
    "title": "v1.4.0 — Otimizações de checkout",
    "date": "2025-09-10",
    "tags": ["added","changed"],
    "body": [
      "Fluxo de pagamento reescrito para reduzir falhas em redes móveis.",
      "Adicionado suporte a pagamentos parcelados via novo gateway."
    ]
  }
]</pre>
          </details>
          <p class="note">Observação: ao carregar por URL, o servidor deve permitir CORS.</p>
        </div>
      </aside>
    </div>
  </main>

  <footer>
    <div class="container">© Fidelyn — Todos os direitos reservados</div>
  </footer>

  <script>
    // estado
    let releasesData = [];

    // util: cria elemento de release
    function createReleaseElement(r){
      const article = document.createElement('article');
      article.className = 'release';
      article.dataset.tags = (r.tags || []).join(',');
      article.dataset.title = (r.title || '').toLowerCase();

      const dot = document.createElement('div'); dot.className = 'dot';
      const body = document.createElement('div'); body.className = 'body';

      const h3 = document.createElement('h3'); h3.textContent = r.title || '';
      const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = r.date || '';

      const tagsWrap = document.createElement('div'); tagsWrap.className = 'tags';
      (r.tags || []).forEach(t => {
        const s = document.createElement('span');
        s.className = 'tag ' + (t);
        s.textContent = (t === 'added' ? 'Adicionado' : t === 'changed' ? 'Alterado' : t === 'fixed' ? 'Corrigido' : t);
        tagsWrap.appendChild(s);
      });

      const ul = document.createElement('ul');
      (r.body || []).forEach(liText => { const li = document.createElement('li'); li.textContent = liText; ul.appendChild(li); });

      body.appendChild(h3);
      body.appendChild(meta);
      if(tagsWrap.children.length) body.appendChild(tagsWrap);
      body.appendChild(ul);

      article.appendChild(dot);
      article.appendChild(body);
      return article;
    }

    // renderiza dados na timeline e no sidebar
    function renderAll(data){
      releasesData = Array.isArray(data) ? data.slice() : [];
      const timeline = document.getElementById('timeline'); timeline.innerHTML = '';
      const versionQuick = document.getElementById('versionQuick'); versionQuick.innerHTML = '';

      releasesData.forEach(r => {
        const el = createReleaseElement(r);
        timeline.appendChild(el);

        const btn = document.createElement('button'); btn.className = 'v'; btn.dataset.scroll = r.title || '';
        btn.innerHTML = `<strong>${r.title || ''}</strong><small class="small">${r.date || ''}</small>`;
        btn.addEventListener('click', () => el.scrollIntoView({behavior:'smooth', block:'center'}));
        versionQuick.appendChild(btn);
      });

      // atualiza versão atual se existir primeira entrada
      if(releasesData[0]){
        document.getElementById('currentVersion').textContent = releasesData[0].title || '';
        document.getElementById('currentDate').textContent = 'Última atualização: ' + (releasesData[0].date || '');
      }

      // re-aplica filtros
      filter();
    }

    // carregamento default: tenta buscar ./changelog.json
    async function loadDefault(){
      try{
        const resp = await fetch('./changelog.json');
        if(!resp.ok) throw new Error('Arquivo não encontrado');
        const data = await resp.json();
        renderAll(data);
      }catch(e){
        // não falha silenciosamente — mantém a página em branco até o usuário carregar
        console.warn('Não foi possível carregar changelog.json automaticamente:', e.message);
      }
    }

    // carregar por URL (verifica CORS)
    async function loadFromUrlPrompt(){
      const url = prompt('Cole a URL do JSON (o servidor deve permitir CORS):');
      if(!url) return;
      try{
        const resp = await fetch(url);
        if(!resp.ok) throw new Error('Erro ao buscar: ' + resp.status);
        const data = await resp.json();
        renderAll(data);
      }catch(e){
        alert('Falha ao carregar por URL: ' + e.message + 'Verifique CORS ou abra o console para detalhes.');
      }
    }

    // carregar de arquivo local via input
    document.getElementById('fileInput').addEventListener('change', async (ev) => {
      const f = ev.target.files && ev.target.files[0];
      if(!f) return;
      try{
        const text = await f.text();
        const data = JSON.parse(text);
        renderAll(data);
      }catch(e){
        alert('Arquivo inválido: ' + e.message);
      }
    });

    document.getElementById('loadUrl').addEventListener('click', loadFromUrlPrompt);

    // filtros e busca
    const chips = document.querySelectorAll('.chip');
    const searchInput = document.getElementById('search');

    chips.forEach(c => c.addEventListener('click', () => {
      // não sobrescrever o botão de carregar arquivo/url que também tem classe chip
      if(c.id === 'loadUrl' || c.getAttribute('for') === 'fileInput') return;
      chips.forEach(x => x.classList.remove('active'));
      c.classList.add('active');
      filter();
    }));

    searchInput.addEventListener('input', filter);

    function filter(){
      const activeEl = document.querySelector('.chip.active');
      const active = activeEl ? activeEl.dataset.filter : 'all';
      const q = searchInput.value.trim().toLowerCase();
      const items = Array.from(document.querySelectorAll('.release'));

      items.forEach(r => {
        const tags = r.dataset.tags ? r.dataset.tags.split(',') : [];
        const title = r.dataset.title || '';
        const text = r.innerText.toLowerCase();

        const matchesFilter = (active === 'all') || tags.includes(active);
        const matchesQuery = q === '' || title.includes(q) || text.includes(q);

        r.style.display = (matchesFilter && matchesQuery) ? '' : 'none';
      });
    }

    // export / copy
    document.getElementById('exportJson').addEventListener('click', () => {
      const out = JSON.stringify(releasesData, null, 2);
      const blob = new Blob([out], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'changelog.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });



    // tentativa de carregar automaticamente ao abrir - útil se você servir o arquivo com um changelog.json ao lado
    loadDefault();
  </script>
</body>
</html>
